# swagger документация

## OpenAPI json

- **URL**: `/site/api-json`
- Компонента формирующая JSON: `components/swagger/ArmsSwaggerApiAction.php`
- Контроллеры на основании которых формируются описание запросов: `/modules/api/controllers`

## Особенности

- Поскольку структура моделей максимально унифицирована и самоописательна - максимальный упор на генерацию 
  документации процессорами из кода классов
- Задача custom генератора ArmsSwaggerApiAction сгенерировать описание 
  - с наследованием аннотаций от базовых классов. Это единственный сценарий, где мы не избегаем аннотирования, 
  т.к. описание многократно переиспользуется при наследовании
  - использованием макросов в аннотациях
  - схемы на основании attributeData + linksSchema моделей
- Для этого в pipeline генерации OpenAPI документа добавлены кастомные шаги:
  - `ExpandControllerActions` - загружает в контроллеры методы из предков и раскрывает макросы в аннотациях
  - `ExpandMacrosProcessor` - раскрывает макросы в аннотациях
  - `GenerateModelSchemaProcessor` - формирует схемы для всех моделей (на основании описания полей в моделях)
  - `RemoveBaseClasses` - убирает из документации базовые классы моделей и контроллеров

## Генерация

Нам необходимо сгенерировть следующие сущности:
- **Paths**: на основании контроллеров в modules/api/controllers; для каждого действия контроллера
  - **tags** - модель, которую обслуживает контроллер: определяется из контроллера
  - **summary** - описание действия: из аннотации действия базового контроллера с макросами, либо аннотация контроллера-потомка
  - **responses** - коды ответов и схемы: из аннотации действия базового контроллера с макросами, либо аннотация контроллера-потомка
    - **codes** - 200, 201, 204, 400, 401, 500
    - **description** - описание кода
    - **content** - application/json
      - **schema** - `$ref: "#/components/schemas/{model}"`
- **Schemas**: на основании моделей, используемых в контроллерах